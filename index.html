<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced System Benchmark Suite</title>
    <link href="https://fonts.googleapis.com/css2?family=Google+Sans:wght@400;500&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Google Sans', sans-serif;
            background: #050505;
            color: #666;
            padding: 40px 20px;
            overflow-x: hidden;
            text-transform: lowercase;
        }

        .header {
            text-align: center;
            margin-bottom: 60px;
        }

        .header h1 {
            color: #444;
            font-size: 1.8em;
            margin-bottom: 8px;
            font-weight: 500;
            letter-spacing: -0.5px;
        }

        .header p {
            color: #333;
            font-size: 0.9em;
            font-weight: 500;
        }

        .controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 50px;
        }

        button {
            padding: 12px 35px;
            font-size: 0.95em;
            border: 1px solid #222;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
            font-weight: 500;
            font-family: 'Google Sans', sans-serif;
            background: #111;
            color: #555;
            text-transform: lowercase;
        }

        button:hover:not(:disabled) {
            background: #222;
            border-color: #333;
            color: #888;
        }

        button:disabled {
            opacity: 0.3;
            cursor: not-allowed;
        }

        /* Slot Machine Animation */
        .slot-container {
            display: inline-flex;
            overflow: hidden;
            height: 1.2em;
            vertical-align: bottom;
            position: relative;
            width: 0.65em;
            justify-content: center;
        }

        .slot-ribbon {
            display: flex;
            flex-direction: column;
            transition: transform 0.6s cubic-bezier(0.23, 1, 0.32, 1);
            position: absolute;
            top: 0;
        }

        .slot-digit {
            height: 1.2em;
            display: flex;
            align-items: center;
            justify-content: center;
            font-variant-numeric: tabular-nums;
        }

        .symbol-container {
            display: inline-flex;
            width: 0.4em;
            justify-content: center;
        }

        .overall-score {
            text-align: center;
            margin-bottom: 20px;
            padding: 40px;
            background: linear-gradient(180deg, #0f0f0f 0%, #050505 100%);
            border-radius: 12px;
            border: 1px solid #1a1a1a;
        }

        .score-value {
            font-size: 4em;
            color: #888;
            font-weight: 500;
            letter-spacing: -2px;
            height: 1.2em;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .timer {
            color: #333;
            font-size: 0.9em;
            margin-top: 15px;
            font-weight: 500;
        }

        /* Comparison Table Styles */
        .comparison-wrapper {
            max-width: 800px;
            margin: 0 auto 50px auto;
            border: 1px solid #1a1a1a;
            border-radius: 8px;
            background: #080808;
            overflow: hidden;
        }

        .comparison-header {
            padding: 15px 20px;
            background: #0c0c0c;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid #1a1a1a;
            user-select: none;
        }

        .comparison-header:hover {
            background: #111;
            color: #888;
        }

        .comparison-content {
            height: 0;
            overflow: hidden;
            background: #080808;
            transition: height 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .comparison-content.expanded {
            height: auto;
            padding: 20px;
        }

        .comp-row {
            margin-bottom: 15px;
        }

        .comp-info {
            display: flex;
            justify-content: space-between;
            font-size: 0.8em;
            margin-bottom: 6px;
            color: #444;
        }

        .comp-bar-bg {
            height: 6px;
            background: #111;
            border-radius: 3px;
            width: 100%;
            position: relative;
            overflow: hidden;
        }

        .comp-bar-fill {
            height: 100%;
            background: #333;
            width: 0%;
            border-radius: 3px;
            transition: width 1s cubic-bezier(0.16, 1, 0.3, 1);
        }

        .comp-bar-fill.user-bar {
            background: #666;
            box-shadow: 0 0 10px rgba(100, 100, 100, 0.2);
        }

        .benchmark-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .benchmark-card {
            background: #0c0c0c;
            border-radius: 8px;
            padding: 24px;
            border: 1px solid #1a1a1a;
            transition: all 0.3s ease;
        }

        .benchmark-card.running {
            border-color: #2a2a2a;
            background: #0e0e0e;
        }

        .benchmark-title {
            color: #555;
            font-size: 0.9em;
            margin-bottom: 12px;
            font-weight: 500;
            display: flex;
            justify-content: space-between;
        }

        .benchmark-score {
            color: #777;
            font-size: 2.2em;
            font-weight: 500;
            margin: 15px 0;
            height: 1.2em;
            display: flex;
            align-items: center;
        }

        .progress-bar {
            width: 100%;
            height: 2px;
            background: #111;
            margin: 20px 0;
            border-radius: 1px;
        }

        .progress-fill {
            height: 100%;
            background: #444;
            width: 0%;
            transition: width 0.1s linear;
        }

        canvas {
            width: 100%;
            height: 60px;
            background: #080808;
            border: 1px solid #161616;
            opacity: 0.3;
            margin-bottom: 10px;
        }

        .metric {
            display: flex;
            justify-content: space-between;
            font-size: 0.85em;
            color: #444;
            margin: 4px 0;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>Advanced System Benchmark</h1>
        <p>Unpredictable Logic Stress Test / Integrated Comparison Analytics</p>
    </div>

    <div class="controls">
        <button id="startBtn" onclick="startBenchmark()">start</button>
        <button id="stopBtn" onclick="stopBenchmark()" disabled>stop</button>
    </div>

    <div class="overall-score">
        <h2>System performance score</h2>
        <div class="score-value" id="overallScore"></div>
        <div class="timer" id="timer">0.0s / 60.0s</div>
    </div>

    <div class="comparison-wrapper">
        <div class="comparison-header" onclick="toggleComparison()">
            <span>Hardware Comparison (Estimated)</span>
            <span id="expandIcon">expand [+]</span>
        </div>
        <div class="comparison-content" id="compContent">
            <!-- Bars populated by JS -->
        </div>
    </div>

    <div class="benchmark-grid" id="benchmarkGrid"></div>

    <script>
        const DURATION = 60000;
        const VISUAL_UPDATE_INTERVAL = 750; 
        const CALC_CHUNK_MS = 100;

        let startTime;
        let running = false;
        let intervals = [];
        let visualUpdateTimer = null;
        
        let scores = {};
        let iterations = {};

        const referenceTiers = [
            { name: "Legacy Desktop (i7-4770K)", score: 12000000 },
            { name: "Standard Laptop (Ryzen 5 5500U)", score: 35000000 },
            { name: "Modern iPad / Mobile (A16 Bionic)", score: 80000000 },
            { name: "High-End Workstation (M3 Max)", score: 115000000 },
            { name: "Enterprise Server Cluster", score: 150000000 }
        ];

        const benchmarks = [
            { id: 'fib', title: 'randomized fibonacci', test: fibTest, unit: 'ops/s' },
            { id: 'prime', title: 'prime search range', test: primeTest, unit: 'primes/s' },
            { id: 'matrix', title: 'dynamic matrix mul', test: matrixTest, unit: 'ops/s' },
            { id: 'sort', title: 'random quicksort', test: sortTest, unit: 'sorts/s' },
            { id: 'hash', title: 'salt-based hashing', test: hashTest, unit: 'hashes/s' },
            { id: 'dom', title: 'dom node stress', test: domTest, unit: 'elements/s' },
            { id: 'regex', title: 'dynamic regex match', test: regexTest, unit: 'matches/s' },
            { id: 'mem', title: 'dynamic allocation', test: memTest, unit: 'mb/s' },
            { id: 'float', title: 'trig math stress', test: floatTest, unit: 'flops/s' },
            { id: 'json', title: 'complex json cycle', test: jsonTest, unit: 'ops/s' }
        ];

        function toggleComparison() {
            const content = document.getElementById('compContent');
            const icon = document.getElementById('expandIcon');
            const isExpanded = content.classList.contains('expanded');
            
            if (isExpanded) {
                content.style.height = '0';
                content.classList.remove('expanded');
                icon.textContent = 'expand [+]';
            } else {
                content.classList.add('expanded');
                content.style.height = content.scrollHeight + 'px';
                icon.textContent = 'collapse [-]';
            }
        }

        function updateSlotValue(elementId, value) {
            const container = document.getElementById(elementId);
            const strValue = Math.floor(value).toLocaleString();
            
            if (container.children.length !== strValue.length) {
                container.innerHTML = '';
                for (let char of strValue) {
                    if (char === ',' || char === '.') {
                        const sym = document.createElement('div');
                        sym.className = 'symbol-container';
                        sym.textContent = char;
                        container.appendChild(sym);
                    } else {
                        const slot = document.createElement('div');
                        slot.className = 'slot-container';
                        const ribbon = document.createElement('div');
                        ribbon.className = 'slot-ribbon';
                        for (let i = 0; i <= 9; i++) {
                            const d = document.createElement('div');
                            d.className = 'slot-digit';
                            d.textContent = i;
                            ribbon.appendChild(d);
                        }
                        slot.appendChild(ribbon);
                        container.appendChild(slot);
                    }
                }
            }

            const children = Array.from(container.children);
            let strIdx = 0;
            children.forEach((child) => {
                if (child.classList.contains('slot-container')) {
                    const ribbon = child.querySelector('.slot-ribbon');
                    const digit = parseInt(strValue[strIdx]);
                    ribbon.style.transform = `translateY(-${digit * 1.2}em)`;
                }
                strIdx++;
            });
        }

        function initComparison() {
            const container = document.getElementById('compContent');
            container.innerHTML = ''; 

            const userRow = document.createElement('div');
            userRow.className = 'comp-row';
            userRow.innerHTML = `
                <div class="comp-info">
                    <span>Current System (You)</span>
                    <span id="userCompVal">0</span>
                </div>
                <div class="comp-bar-bg"><div class="comp-bar-fill user-bar" id="userCompBar"></div></div>
            `;
            container.appendChild(userRow);

            referenceTiers.forEach(tier => {
                const row = document.createElement('div');
                row.className = 'comp-row';
                row.innerHTML = `
                    <div class="comp-info">
                        <span>${tier.name}</span>
                        <span>${tier.score.toLocaleString()}</span>
                    </div>
                    <div class="comp-bar-bg"><div class="comp-bar-fill" style="width: ${Math.min(100, (tier.score/150000000)*100)}%"></div></div>
                `;
                container.appendChild(row);
            });
        }

        function init() {
            const grid = document.getElementById('benchmarkGrid');
            updateSlotValue('overallScore', 0);
            initComparison();

            benchmarks.forEach(b => {
                const card = document.createElement('div');
                card.className = 'benchmark-card';
                card.id = `card-${b.id}`;
                card.innerHTML = `
                    <div class="benchmark-title">${b.title} <span id="status-${b.id}">ready</span></div>
                    <canvas id="canvas-${b.id}"></canvas>
                    <div class="benchmark-score" id="score-${b.id}"></div>
                    <div class="progress-bar"><div class="progress-fill" id="progress-${b.id}"></div></div>
                    <div class="metric"><span>${b.unit}</span><span id="iter-${b.id}">0</span></div>
                `;
                grid.appendChild(card);
                scores[b.id] = 0;
                iterations[b.id] = 0;
                updateSlotValue(`score-${b.id}`, 0);
            });
        }

        function startBenchmark() {
            if (running) return;
            running = true;
            startTime = Date.now();
            document.getElementById('startBtn').disabled = true;
            document.getElementById('stopBtn').disabled = false;

            benchmarks.forEach(b => {
                const card = document.getElementById(`card-${b.id}`);
                if(card) card.classList.add('running');
                b.test(b.id);
            });

            visualUpdateTimer = setInterval(() => {
                benchmarks.forEach(b => {
                    updateSlotValue(`score-${b.id}`, scores[b.id]);
                    document.getElementById(`iter-${b.id}`).textContent = Math.floor(iterations[b.id]).toLocaleString();
                });
                const total = Object.values(scores).reduce((a, b) => a + b, 0);
                const avg = total / benchmarks.length;
                updateSlotValue('overallScore', avg);

                const userBar = document.getElementById('userCompBar');
                const userVal = document.getElementById('userCompVal');
                const maxVal = 150000000;
                if (userBar) userBar.style.width = Math.min(100, (avg / maxVal) * 100) + '%';
                if (userVal) userVal.textContent = Math.floor(avg).toLocaleString();
            }, VISUAL_UPDATE_INTERVAL);

            requestAnimationFrame(updateLoop);
        }

        function updateLoop() {
            if (!running) return;
            const elapsed = Date.now() - startTime;
            const prog = (elapsed / DURATION) * 100;
            document.getElementById('timer').textContent = `${(elapsed/1000).toFixed(1)}s / 60.0s`;
            benchmarks.forEach(b => {
                const fill = document.getElementById(`progress-${b.id}`);
                if (fill) fill.style.width = Math.min(prog, 100) + '%';
            });
            if (elapsed >= DURATION) stopBenchmark();
            else requestAnimationFrame(updateLoop);
        }

        function stopBenchmark() {
            running = false;
            clearInterval(visualUpdateTimer);
            intervals.forEach(clearInterval);
            document.getElementById('startBtn').disabled = false;
            document.getElementById('stopBtn').disabled = true;
            benchmarks.forEach(b => {
                const card = document.getElementById(`card-${b.id}`);
                const status = document.getElementById(`status-${b.id}`);
                if(card) card.classList.remove('running');
                if(status) status.textContent = 'done';
            });
        }

        // --- STRESS TESTS ---

        function fibTest(id) {
            const int = setInterval(() => {
                if (!running) return;
                let count = 0;
                const start = performance.now();
                while (performance.now() - start < CALC_CHUNK_MS) {
                    const input = 18 + Math.floor(Math.random() * 8); 
                    const f = (x) => x <= 1 ? x : f(x-1) + f(x-2);
                    f(input);
                    count++;
                }
                iterations[id] += count;
                scores[id] = count * 600; 
            }, 10);
            intervals.push(int);
        }

        function primeTest(id) {
            const int = setInterval(() => {
                if (!running) return;
                let count = 0;
                const start = performance.now();
                while (performance.now() - start < CALC_CHUNK_MS) {
                    let num = 1000 + Math.floor(Math.random() * 5000);
                    let found = 0;
                    while(found < 10) {
                        let isP = true;
                        for(let i=2; i<=Math.sqrt(num); i++) { if(num%i===0){isP=false; break;} }
                        if(isP) found++;
                        num++;
                    }
                    count++;
                }
                iterations[id] += count;
                scores[id] = count * 9000;
            }, 10);
            intervals.push(int);
        }

        function matrixTest(id) {
            const int = setInterval(() => {
                if (!running) return;
                let count = 0;
                const start = performance.now();
                while (performance.now() - start < CALC_CHUNK_MS) {
                    const size = 20 + Math.floor(Math.random() * 20);
                    const a = new Float64Array(size * size);
                    for(let i=0; i<a.length; i++) a[i] = Math.random();
                    count++;
                }
                iterations[id] += count;
                scores[id] = count * 7500;
            }, 10);
            intervals.push(int);
        }

        function sortTest(id) {
            const int = setInterval(() => {
                if (!running) return;
                let count = 0;
                const start = performance.now();
                while (performance.now() - start < CALC_CHUNK_MS) {
                    const len = 500 + Math.floor(Math.random() * 1000);
                    const a = Array.from({length: len}, () => Math.random());
                    a.sort();
                    count++;
                }
                iterations[id] += count;
                scores[id] = count * 3600;
            }, 10);
            intervals.push(int);
        }

        function hashTest(id) {
            const int = setInterval(() => {
                if (!running) return;
                let count = 0;
                const start = performance.now();
                while (performance.now() - start < CALC_CHUNK_MS) {
                    let s = Math.random().toString(36).substring(7) + Date.now();
                    let h = 0;
                    for(let i=0; i<s.length; i++) h = (h << 5) - h + s.charCodeAt(i);
                    count++;
                }
                iterations[id] += count;
                scores[id] = count * 7500;
            }, 10);
            intervals.push(int);
        }

        function domTest(id) {
            const int = setInterval(() => {
                if (!running) return;
                let count = 0;
                const start = performance.now();
                while (performance.now() - start < CALC_CHUNK_MS) {
                    const d = document.createElement('div');
                    d.textContent = Math.random();
                    count++;
                }
                iterations[id] += count;
                scores[id] = count * 1200;
            }, 10);
            intervals.push(int);
        }

        function regexTest(id) {
            const int = setInterval(() => {
                if (!running) return;
                let count = 0;
                const start = performance.now();
                while (performance.now() - start < CALC_CHUNK_MS) {
                    const salt = Math.random().toString();
                    const str = "pattern " + salt + " match ".repeat(10);
                    const regex = new RegExp(salt, 'g');
                    str.match(regex);
                    count++;
                }
                iterations[id] += count;
                scores[id] = count * 6000;
            }, 10);
            intervals.push(int);
        }

        function memTest(id) {
            const int = setInterval(() => {
                if (!running) return;
                let mb = 0;
                const start = performance.now();
                while (performance.now() - start < CALC_CHUNK_MS) {
                    const size = 5000 + Math.floor(Math.random() * 20000);
                    const a = new Float64Array(size);
                    mb += (a.byteLength / 1024 / 1024);
                }
                iterations[id] += mb;
                scores[id] = Math.floor(mb * 18000);
            }, 10);
            intervals.push(int);
        }

        function floatTest(id) {
            const int = setInterval(() => {
                if (!running) return;
                let count = 0;
                const start = performance.now();
                while (performance.now() - start < CALC_CHUNK_MS) {
                    const r = Math.random();
                    Math.sin(r) * Math.cos(r) * Math.tan(r) * Math.asin(r);
                    count++;
                }
                iterations[id] += count;
                scores[id] = count * 4.5;
            }, 10);
            intervals.push(int);
        }

        function jsonTest(id) {
            const int = setInterval(() => {
                if (!running) return;
                let count = 0;
                const start = performance.now();
                while (performance.now() - start < CALC_CHUNK_MS) {
                    const obj = { r: Math.random(), s: "str"+Math.random(), a: [Math.random()] };
                    JSON.parse(JSON.stringify(obj));
                    count++;
                }
                iterations[id] += count;
                scores[id] = count * 5400;
            }, 10);
            intervals.push(int);
        }

        window.addEventListener('load', init);
    </script>
</body>
</html>
