<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LCG Pattern Visualizer</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            background-color: #111827; /* gray-900 */
            color: #e5e7eb; /* gray-200 */
            font-family: 'Courier New', Courier, monospace;
        }
        canvas {
            image-rendering: pixelated; /* Keeps pixels sharp at low res */
            box-shadow: 0 0 20px rgba(0,0,0,0.5);
        }
        .monitor-text {
            text-shadow: 0 0 5px rgba(34, 197, 94, 0.5);
        }
    </style>
</head>
<body class="min-h-screen flex flex-col items-center justify-center p-4">

    <!-- Header -->
    <div class="text-center mb-6">
        <h1 class="text-3xl md:text-4xl font-bold mb-2 text-green-400 monitor-text">LCG Visualizer</h1>
        <p class="text-sm text-gray-400">Linear Congruential Generator Texture Mapper</p>
    </div>

    <!-- Main Container -->
    <div class="bg-gray-800 p-6 rounded-xl border border-gray-700 shadow-2xl max-w-full w-auto flex flex-col items-center gap-6">
        
        <!-- Canvas Wrapper -->
        <div class="relative group">
            <canvas id="canvas" width="256" height="256" class="bg-black rounded border-2 border-gray-600 cursor-pointer"></canvas>
            <div class="absolute bottom-2 right-2 opacity-0 group-hover:opacity-100 transition-opacity bg-black bg-opacity-75 text-xs px-2 py-1 rounded pointer-events-none">
                Click to Regenerate
            </div>
        </div>

        <!-- Controls & Info -->
        <div class="w-full max-w-md space-y-4">
            
            <!-- Parameters Display -->
            <div class="bg-black bg-opacity-50 p-4 rounded border border-gray-600 font-mono text-xs md:text-sm">
                <div class="flex justify-between items-center mb-2 border-b border-gray-700 pb-2">
                    <span class="text-green-500 font-bold">Formula:</span>
                    <span class="text-gray-300">X<sub>n+1</sub> = (aX<sub>n</sub> + c) % m</span>
                </div>
                <div class="grid grid-cols-2 gap-y-1">
                    <span class="text-gray-400">Modulus (m):</span>
                    <span id="val-m" class="text-right text-blue-400">65536</span>
                    
                    <span class="text-gray-400">Multiplier (a):</span>
                    <span id="val-a" class="text-right text-yellow-400">--</span>
                    
                    <span class="text-gray-400">Increment (c):</span>
                    <span id="val-c" class="text-right text-pink-400">--</span>
                    
                    <span class="text-gray-400">Seed (X<sub>0</sub>):</span>
                    <span id="val-seed" class="text-right text-white">--</span>
                </div>
            </div>

            <!-- Inputs -->
            <div class="flex flex-col sm:flex-row gap-3">
                <div class="flex-1">
                    <label class="block text-xs text-gray-500 mb-1 uppercase tracking-wider">Grid Size</label>
                    <select id="gridSize" class="w-full bg-gray-700 border border-gray-600 text-white rounded px-3 py-2 focus:outline-none focus:border-green-500 transition-colors">
                        <option value="32">32 x 32 (Micro)</option>
                        <option value="64">64 x 64 (Tiny)</option>
                        <option value="128">128 x 128 (Small)</option>
                        <option value="256" selected>256 x 256 (Standard)</option>
                        <option value="512">512 x 512 (Large)</option>
                        <option value="1024">1024 x 1024 (HD)</option>
                    </select>
                </div>
                <div class="flex-1">
                    <label class="block text-xs text-gray-500 mb-1 uppercase tracking-wider">Action</label>
                    <button id="generateBtn" class="w-full bg-green-600 hover:bg-green-500 text-white font-bold py-2 px-4 rounded transition-colors shadow-lg active:transform active:scale-95">
                        New Pattern
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Explanation -->
    <div class="max-w-xl mt-8 text-gray-400 text-xs md:text-sm text-center leading-relaxed">
        <p>
            The grid visualizes the sequence of numbers generated by the LCG algorithm. 
            Each pixel corresponds to one iteration. <br>
            <span class="text-gray-300">Darker pixels</span> represent values closer to <strong>m</strong>.
            <span class="text-gray-300">Lighter pixels</span> represent values closer to <strong>0</strong>.
            We use the Hull-Dobell Theorem to select random multipliers that guarantee a "Full Period," meaning every unique gray value appears exactly once.
        </p>
    </div>

    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        const generateBtn = document.getElementById('generateBtn');
        const gridSizeSelect = document.getElementById('gridSize');

        // UI Elements
        const valM = document.getElementById('val-m');
        const valA = document.getElementById('val-a');
        const valC = document.getElementById('val-c');
        const valSeed = document.getElementById('val-seed');

        let width, height, m;

        // Generate a random integer between min and max (inclusive)
        function getRandomInt(min, max) {
            return Math.floor(Math.random() * (max - min + 1)) + min;
        }

        // Greatest Common Divisor
        function gcd(a, b) {
            return b === 0 ? a : gcd(b, a % b);
        }

        // Generate LCG Parameters
        // We want a full period LCG, so we follow Hull-Dobell Theorem for m = power of 2
        function generateParams() {
            // 1. Determine M based on grid size
            const dimension = parseInt(gridSizeSelect.value);
            width = dimension;
            height = dimension;
            m = width * height;

            // 2. Generate 'c' (Increment)
            // Hull-Dobell: c and m must be relatively prime.
            // Since m is a power of 2, c must just be odd.
            let c = getRandomInt(1, m - 1);
            if (c % 2 === 0) c += 1; // Ensure odd

            // 3. Generate 'a' (Multiplier)
            // Hull-Dobell: a - 1 must be divisible by all prime factors of m.
            // Since m is power of 2, a-1 must be divisible by 2.
            // Also, if m is multiple of 4 (which it is for any grid >= 2x2), a-1 must be divisible by 4.
            // So, a = 4k + 1.
            
            // We'll pick a random k.
            // If k is too small, we get simple visible stripes.
            // If k is large and random, we get noise.
            // Let's create a mix of possibilities.
            const maxK = Math.floor((m - 1) / 4);
            const k = getRandomInt(1, maxK); 
            const a = 1 + 4 * k;

            // 4. Random seed
            const seed = getRandomInt(0, m - 1);

            return { a, c, m, seed };
        }

        function renderLCG() {
            const params = generateParams();
            
            // Update UI
            valM.textContent = params.m.toLocaleString();
            valA.textContent = params.a.toLocaleString();
            valC.textContent = params.c.toLocaleString();
            valSeed.textContent = params.seed.toLocaleString();

            // Resize Canvas Display
            // We use CSS to make it look big, but internal resolution matches the grid
            canvas.width = width;
            canvas.height = height;

            // For larger grids, limit the CSS max-width to keep it on screen
            if (width > 512) {
                canvas.style.width = '100%';
                canvas.style.maxWidth = '600px';
                canvas.style.height = 'auto';
            } else {
                canvas.style.width = '';
                canvas.style.height = '';
                canvas.style.maxWidth = '';
            }

            // Create Image Data
            const imageData = ctx.createImageData(width, height);
            const data = imageData.data;

            let x = params.seed;
            const a = params.a;
            const c = params.c;
            const mod = params.m;

            // Pre-calculate inverse m for speed
            const invM = 255 / mod;

            for (let i = 0; i < mod; i++) {
                // Generate next number
                // Standard LCG: X_n+1 = (aX_n + c) % m
                // Note: using BigInt is safer for very large numbers, 
                // but standard JS numbers (doubles) are safe integers up to 2^53.
                // Our max m is 1024*1024 = 2^20 approx 1 million.
                // a * x can be approx m * m = 2^40. 
                // 2^40 < 2^53, so regular math is fine.
                
                x = (a * x + c) % mod;

                // Calculate color
                // User requirement: "higher numbers (near the module) are darker"
                // Value 0 -> Light (255)
                // Value m -> Dark (0)
                const intensity = 255 - Math.floor(x * invM);

                // Pixel index in imageData array (4 values per pixel: r,g,b,a)
                const index = i * 4;

                data[index] = intensity;     // Red
                data[index + 1] = intensity; // Green
                data[index + 2] = intensity; // Blue
                data[index + 3] = 255;       // Alpha (Opaque)
            }

            ctx.putImageData(imageData, 0, 0);
        }

        // Event Listeners
        generateBtn.addEventListener('click', renderLCG);
        canvas.addEventListener('click', renderLCG);
        
        // Initial Render
        renderLCG();

    </script>
</body>
</html>
