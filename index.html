<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced System Benchmark Suite</title>
    <link href="https://fonts.googleapis.com/css2?family=Google+Sans:wght@400;500&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Google Sans', sans-serif;
            background: #050505;
            color: #666;
            padding: 40px 20px;
            overflow-x: hidden;
            text-transform: lowercase;
        }

        .header {
            text-align: center;
            margin-bottom: 60px;
        }

        .header h1 {
            color: #444;
            font-size: 1.8em;
            margin-bottom: 8px;
            font-weight: 500;
            letter-spacing: -0.5px;
        }

        .header p {
            color: #333;
            font-size: 0.9em;
            font-weight: 500;
        }

        .controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 50px;
        }

        button {
            padding: 12px 35px;
            font-size: 0.95em;
            border: 1px solid #222;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
            font-weight: 500;
            font-family: 'Google Sans', sans-serif;
            background: #111;
            color: #555;
            text-transform: lowercase;
        }

        button:hover:not(:disabled) {
            background: #222;
            border-color: #333;
            color: #888;
        }

        button:disabled {
            opacity: 0.3;
            cursor: not-allowed;
        }

        /* Seamless Slot Machine Animation */
        .slot-container {
            display: inline-flex;
            overflow: hidden;
            height: 1.2em;
            vertical-align: bottom;
            position: relative;
            width: 0.65em;
            justify-content: center;
        }

        .slot-ribbon {
            display: flex;
            flex-direction: column;
            transition: transform 0.6s cubic-bezier(0.23, 1, 0.32, 1);
            position: absolute;
            top: 0;
        }

        .slot-digit {
            height: 1.2em;
            display: flex;
            align-items: center;
            justify-content: center;
            font-variant-numeric: tabular-nums;
        }

        .symbol-container {
            display: inline-flex;
            width: 0.4em;
            justify-content: center;
        }

        .overall-score {
            text-align: center;
            margin-bottom: 50px;
            padding: 40px;
            background: linear-gradient(180deg, #0f0f0f 0%, #050505 100%);
            border-radius: 12px;
            border: 1px solid #1a1a1a;
        }

        .score-value {
            font-size: 4em;
            color: #888;
            font-weight: 500;
            letter-spacing: -2px;
            height: 1.2em;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .timer {
            color: #333;
            font-size: 0.9em;
            margin-top: 15px;
            font-weight: 500;
        }

        .benchmark-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .benchmark-card {
            background: #0c0c0c;
            border-radius: 8px;
            padding: 24px;
            border: 1px solid #1a1a1a;
            transition: all 0.3s ease;
        }

        .benchmark-card.running {
            border-color: #2a2a2a;
            background: #0e0e0e;
        }

        .benchmark-title {
            color: #555;
            font-size: 0.9em;
            margin-bottom: 12px;
            font-weight: 500;
            display: flex;
            justify-content: space-between;
        }

        .benchmark-score {
            color: #777;
            font-size: 2.2em;
            font-weight: 500;
            margin: 15px 0;
            height: 1.2em;
            display: flex;
            align-items: center;
        }

        .progress-bar {
            width: 100%;
            height: 2px;
            background: #111;
            margin: 20px 0;
            border-radius: 1px;
        }

        .progress-fill {
            height: 100%;
            background: #444;
            width: 0%;
            transition: width 0.1s linear;
        }

        canvas {
            width: 100%;
            height: 60px;
            background: #080808;
            border: 1px solid #161616;
            opacity: 0.4;
            margin-bottom: 10px;
        }

        .metric {
            display: flex;
            justify-content: space-between;
            font-size: 0.85em;
            color: #444;
            margin: 4px 0;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>Advanced System Benchmark</h1>
        <p>Unrestricted Stress Test / 0.75s Rolling Update</p>
    </div>

    <div class="controls">
        <button id="startBtn" onclick="startBenchmark()">start</button>
        <button id="stopBtn" onclick="stopBenchmark()" disabled>stop</button>
    </div>

    <div class="overall-score">
        <h2>System performance score</h2>
        <div class="score-value" id="overallScore"></div>
        <div class="timer" id="timer">0.0s / 60.0s</div>
    </div>

    <div class="benchmark-grid" id="benchmarkGrid"></div>

    <script>
        const DURATION = 60000;
        const VISUAL_UPDATE_INTERVAL = 750; 
        const CALC_CHUNK_MS = 100; // How long to run a calculation block

        let startTime;
        let running = false;
        let intervals = [];
        let animationFrames = [];
        let visualUpdateTimer = null;
        
        let scores = {};
        let iterations = {};

        const benchmarks = [
            { id: 'fib', title: 'fibonacci recursion', test: fibTest, unit: 'ops/s' },
            { id: 'prime', title: 'prime discovery', test: primeTest, unit: 'primes/s' },
            { id: 'matrix', title: 'matrix product', test: matrixTest, unit: 'ops/s' },
            { id: 'sort', title: 'array quicksort', test: sortTest, unit: 'sorts/s' },
            { id: 'hash', title: 'sha-256 simulation', test: hashTest, unit: 'hashes/s' },
            { id: 'dom', title: 'dom node stress', test: domTest, unit: 'elements/s' },
            { id: 'regex', title: 'pattern matching', test: regexTest, unit: 'matches/s' },
            { id: 'mem', title: 'heap allocation', test: memTest, unit: 'mb/s' },
            { id: 'float', title: 'floating point', test: floatTest, unit: 'flops/s' },
            { id: 'json', title: 'json serialization', test: jsonTest, unit: 'ops/s' }
        ];

        function updateSlotValue(elementId, value) {
            const container = document.getElementById(elementId);
            const strValue = Math.floor(value).toLocaleString();
            
            // Adjust number of columns
            if (container.children.length !== strValue.length) {
                container.innerHTML = '';
                for (let char of strValue) {
                    if (char === ',' || char === '.') {
                        const sym = document.createElement('div');
                        sym.className = 'symbol-container';
                        sym.textContent = char;
                        container.appendChild(sym);
                    } else {
                        const slot = document.createElement('div');
                        slot.className = 'slot-container';
                        const ribbon = document.createElement('div');
                        ribbon.className = 'slot-ribbon';
                        // 0-9 digits
                        for (let i = 0; i <= 9; i++) {
                            const d = document.createElement('div');
                            d.className = 'slot-digit';
                            d.textContent = i;
                            ribbon.appendChild(d);
                        }
                        slot.appendChild(ribbon);
                        container.appendChild(slot);
                    }
                }
            }

            // Animate ribbons
            const children = Array.from(container.children);
            let strIdx = 0;
            children.forEach((child) => {
                if (child.classList.contains('slot-container')) {
                    const ribbon = child.querySelector('.slot-ribbon');
                    const digit = parseInt(strValue[strIdx]);
                    ribbon.style.transform = `translateY(-${digit * 1.2}em)`;
                }
                strIdx++;
            });
        }

        function init() {
            const grid = document.getElementById('benchmarkGrid');
            updateSlotValue('overallScore', 0);

            benchmarks.forEach(b => {
                const card = document.createElement('div');
                card.className = 'benchmark-card';
                card.id = `card-${b.id}`;
                card.innerHTML = `
                    <div class="benchmark-title">${b.title} <span id="status-${b.id}">ready</span></div>
                    <canvas id="canvas-${b.id}"></canvas>
                    <div class="benchmark-score" id="score-${b.id}"></div>
                    <div class="progress-bar"><div class="progress-fill" id="progress-${b.id}"></div></div>
                    <div class="metric"><span>${b.unit}</span><span id="iter-${b.id}">0</span></div>
                `;
                grid.appendChild(card);
                scores[b.id] = 0;
                iterations[b.id] = 0;
                updateSlotValue(`score-${b.id}`, 0);
            });
        }

        function startBenchmark() {
            if (running) return;
            running = true;
            startTime = Date.now();
            document.getElementById('startBtn').disabled = true;
            document.getElementById('stopBtn').disabled = false;

            benchmarks.forEach(b => {
                document.getElementById(`card-${b.id}`).classList.add('running');
                b.test(b.id);
            });

            visualUpdateTimer = setInterval(() => {
                benchmarks.forEach(b => {
                    updateSlotValue(`score-${b.id}`, scores[b.id]);
                    document.getElementById(`iter-${b.id}`).textContent = Math.floor(iterations[b.id]).toLocaleString();
                });
                const total = Object.values(scores).reduce((a, b) => a + b, 0);
                updateSlotValue('overallScore', total / benchmarks.length);
            }, VISUAL_UPDATE_INTERVAL);

            requestAnimationFrame(updateLoop);
        }

        function updateLoop() {
            if (!running) return;
            const elapsed = Date.now() - startTime;
            const prog = (elapsed / DURATION) * 100;
            document.getElementById('timer').textContent = `${(elapsed/1000).toFixed(1)}s / 60.0s`;
            benchmarks.forEach(b => {
                document.getElementById(`progress-${b.id}`).style.width = Math.min(prog, 100) + '%';
            });
            if (elapsed >= DURATION) stopBenchmark();
            else requestAnimationFrame(updateLoop);
        }

        function stopBenchmark() {
            running = false;
            clearInterval(visualUpdateTimer);
            intervals.forEach(clearInterval);
            animationFrames.forEach(cancelAnimationFrame);
            document.getElementById('startBtn').disabled = false;
            document.getElementById('stopBtn').disabled = true;
            benchmarks.forEach(b => {
                document.getElementById(`card-${b.id}`).classList.remove('running');
                document.getElementById(`status-${b.id}`).textContent = 'done';
            });
        }

        // --- STRESS TESTS ---

        function fibTest(id) {
            let total = 0;
            const int = setInterval(() => {
                if (!running) return;
                let count = 0;
                const start = performance.now();
                while (performance.now() - start < CALC_CHUNK_MS) {
                    let n = 20;
                    const f = (x) => x <= 1 ? x : f(x-1) + f(x-2);
                    f(n);
                    count++;
                }
                total += count;
                scores[id] = count * 10;
                iterations[id] = total;
            }, 10);
            intervals.push(int);
        }

        function primeTest(id) {
            let total = 0;
            const int = setInterval(() => {
                if (!running) return;
                let count = 0;
                const start = performance.now();
                let num = 2;
                while (performance.now() - start < CALC_CHUNK_MS) {
                    let isP = true;
                    for(let i=2; i<=Math.sqrt(num); i++) { if(num%i===0){isP=false; break;} }
                    if(isP) count++;
                    num++;
                }
                total += count;
                scores[id] = count * 10;
                iterations[id] = total;
            }, 10);
            intervals.push(int);
        }

        function matrixTest(id) {
            let total = 0;
            const int = setInterval(() => {
                if (!running) return;
                let count = 0;
                const start = performance.now();
                while (performance.now() - start < CALC_CHUNK_MS) {
                    const size = 20;
                    for(let i=0; i<size*size; i++) { Math.random() * Math.random(); }
                    count++;
                }
                total += count;
                scores[id] = count * 100;
                iterations[id] = total;
            }, 10);
            intervals.push(int);
        }

        function sortTest(id) {
            let total = 0;
            const int = setInterval(() => {
                if (!running) return;
                let count = 0;
                const start = performance.now();
                while (performance.now() - start < CALC_CHUNK_MS) {
                    const a = Array.from({length: 500}, () => Math.random());
                    a.sort();
                    count++;
                }
                total += count;
                scores[id] = count * 10;
                iterations[id] = total;
            }, 10);
            intervals.push(int);
        }

        function hashTest(id) {
            let total = 0;
            const int = setInterval(() => {
                if (!running) return;
                let count = 0;
                const start = performance.now();
                while (performance.now() - start < CALC_CHUNK_MS) {
                    let s = Math.random().toString();
                    let h = 0;
                    for(let i=0; i<s.length; i++) h = (h << 5) - h + s.charCodeAt(i);
                    count++;
                }
                total += count;
                scores[id] = count * 100;
                iterations[id] = total;
            }, 10);
            intervals.push(int);
        }

        function domTest(id) {
            let total = 0;
            const int = setInterval(() => {
                if (!running) return;
                let count = 0;
                const start = performance.now();
                const frag = document.createDocumentFragment();
                while (performance.now() - start < CALC_CHUNK_MS) {
                    const d = document.createElement('div');
                    frag.appendChild(d);
                    count++;
                }
                total += count;
                scores[id] = count * 10;
                iterations[id] = total;
            }, 10);
            intervals.push(int);
        }

        function regexTest(id) {
            let total = 0;
            const int = setInterval(() => {
                if (!running) return;
                let count = 0;
                const start = performance.now();
                const str = "test string ".repeat(100);
                while (performance.now() - start < CALC_CHUNK_MS) {
                    str.match(/string/g);
                    count++;
                }
                total += count;
                scores[id] = count * 10;
                iterations[id] = total;
            }, 10);
            intervals.push(int);
        }

        function memTest(id) {
            let total = 0;
            const int = setInterval(() => {
                if (!running) return;
                let mb = 0;
                const start = performance.now();
                while (performance.now() - start < CALC_CHUNK_MS) {
                    const a = new Float64Array(10000);
                    mb += (a.byteLength / 1024 / 1024);
                }
                total += mb;
                scores[id] = Math.floor(mb * 10);
                iterations[id] = total;
            }, 10);
            intervals.push(int);
        }

        function floatTest(id) {
            let total = 0;
            const int = setInterval(() => {
                if (!running) return;
                let count = 0;
                const start = performance.now();
                while (performance.now() - start < CALC_CHUNK_MS) {
                    Math.sin(Math.random()) * Math.cos(Math.random());
                    count++;
                }
                total += count;
                scores[id] = count;
                iterations[id] = total;
            }, 10);
            intervals.push(int);
        }

        function jsonTest(id) {
            let total = 0;
            const int = setInterval(() => {
                if (!running) return;
                let count = 0;
                const start = performance.now();
                const obj = { x: 1, y: "string", z: [1,2,3] };
                while (performance.now() - start < CALC_CHUNK_MS) {
                    JSON.parse(JSON.stringify(obj));
                    count++;
                }
                total += count;
                scores[id] = count * 10;
                iterations[id] = total;
            }, 10);
            intervals.push(int);
        }

        init();
    </script>
</body>
</html>
